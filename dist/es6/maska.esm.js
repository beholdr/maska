/*!
 * maska v1.5.0
 * (c) 2019-2021 Alexander Shabunevich
 * Released under the MIT License.
 */
var t={"#":{pattern:/[0-9]/},X:{pattern:/[0-9a-zA-Z]/},S:{pattern:/[a-zA-Z]/},A:{pattern:/[a-zA-Z]/,uppercase:!0},a:{pattern:/[a-zA-Z]/,lowercase:!0},"!":{escape:!0},"*":{repeat:!0}};function e(e,s,r=t,o=!0){return n(s).length>1?function(t){const e=n(t).sort(((t,e)=>t.length-e.length));return function(t,n,r,o=!0){const i=e.map((e=>a(t,e,r,!1))).pop();for(const n in e)if(s(i,e[n],r))return a(t,e[n],r,o);return""};function s(t,e,n){for(const t in n)n[t].escape&&(e=e.replace(new RegExp(t+".{1}","g"),""));return e.split("").filter((t=>n[t]&&n[t].pattern)).length>=t.length}}(s)(e,s,r,o):a(e,s,r,o)}function n(t){try{return JSON.parse(t)}catch{return[t]}}function a(t,e,n,a=!0){let r=0,o=0,i="",u="";for(;r<e.length&&o<t.length;){let u=e[r];const p=t[o],l=n[u];if(l&&l.pattern)l.pattern.test(p)&&(i+=s(p,l),r++,a&&e[r]&&(n[e[r]]?n[e[r]]&&n[e[r]].escape&&(i+=e[r+1],r+=2):(i+=e[r],r++))),o++;else if(l&&l.repeat){const t=n[e[r-1]];t&&!t.pattern.test(p)?r++:r--}else l&&l.escape&&(r++,u=e[r]),a&&(i+=u),p===u&&o++,r++}for(;a&&r<e.length;){const t=e[r];if(n[t]){u="";break}u+=t,r++}return i+u}function s(t,e){return e.transform&&(t=e.transform(t)),e.uppercase?t.toLocaleUpperCase():e.lowercase?t.toLocaleLowerCase():t}function r(t){return t instanceof HTMLInputElement?t:t.querySelector("input")||t}function o(t){return"[object String]"===Object.prototype.toString.call(t)}class i{constructor(e,n={}){if(!e)throw new Error("Maska: no element for mask");if(null!=n.preprocessor&&"function"!=typeof n.preprocessor)throw new Error("Maska: preprocessor must be a function");if(n.tokens)for(const t in n.tokens)n.tokens[t]={...n.tokens[t]},n.tokens[t].pattern&&o(n.tokens[t].pattern)&&(n.tokens[t].pattern=new RegExp(n.tokens[t].pattern));this._opts={mask:n.mask,tokens:{...t,...n.tokens},preprocessor:n.preprocessor},this._el=o(e)?document.querySelectorAll(e):e.length?e:[e],this.inputEvent=t=>this.updateValue(t.target,t),this.init()}init(){for(let t=0;t<this._el.length;t++){const e=r(this._el[t]);!this._opts.mask||e.dataset.mask&&e.dataset.mask===this._opts.mask||(e.dataset.mask=this._opts.mask),setTimeout((()=>this.updateValue(e)),0),e.dataset.maskInited||(e.dataset.maskInited=!0,e.addEventListener("input",this.inputEvent),e.addEventListener("beforeinput",this.beforeInput))}}destroy(){for(let t=0;t<this._el.length;t++){const e=r(this._el[t]);e.removeEventListener("input",this.inputEvent),e.removeEventListener("beforeinput",this.beforeInput),delete e.dataset.mask,delete e.dataset.maskInited}}updateValue(t,n){if(!t||!t.type)return;const a=t.type.match(/^number$/i)&&t.validity.badInput;if(!t.value&&!a||!t.dataset.mask)return t.dataset.maskRawValue="",void this.dispatch("maska",t,n);let s=t.selectionEnd;const r=t.value,o=r[s-1];t.dataset.maskRawValue=e(t.value,t.dataset.mask,this._opts.tokens,!1);let i=t.value;this._opts.preprocessor&&(i=this._opts.preprocessor(i)),t.value=e(i,t.dataset.mask,this._opts.tokens),n&&"insertText"===n.inputType&&s===r.length&&(s=t.value.length),function(t,e,n){for(;e&&e<t.value.length&&t.value.charAt(e-1)!==n;)e++;(t.type?t.type.match(/^(text|search|password|tel|url)$/i):!t.type)&&t===document.activeElement&&(t.setSelectionRange(e,e),setTimeout((function(){t.setSelectionRange(e,e)}),0))}(t,s,o),this.dispatch("maska",t,n),t.value!==r&&this.dispatch("input",t,n)}beforeInput(t){t&&t.target&&t.target.type&&t.target.type.match(/^number$/i)&&t.data&&isNaN(t.target.value+t.data)&&t.preventDefault()}dispatch(t,e,n){e.dispatchEvent(function(t,e=null){const n=document.createEvent("Event");return n.initEvent(t,!0,!0),e&&(n.inputType=e),n}(t,n&&n.inputType||null))}}var u=(()=>{const t=new WeakMap;return(e,n)=>{n.value&&(t.has(e)&&!function(t){return!(o(t.value)&&t.value===t.oldValue||Array.isArray(t.value)&&JSON.stringify(t.value)===JSON.stringify(t.oldValue)||t.value&&t.value.mask&&t.oldValue&&t.oldValue.mask&&t.value.mask===t.oldValue.mask)}(n)||t.set(e,new i(e,function(t){const e={};return t.mask?(e.mask=Array.isArray(t.mask)?JSON.stringify(t.mask):t.mask,e.tokens=t.tokens?{...t.tokens}:{},e.preprocessor=t.preprocessor):e.mask=Array.isArray(t)?JSON.stringify(t):t,e}(n.value))))}})();function p(t){t.directive("maska",u)}function l(t,e){return new i(t,e)}"undefined"!=typeof window&&window.Vue&&window.Vue.use&&window.Vue.use(p);export default p;export{l as create,p as install,e as mask,u as maska,t as tokens};
